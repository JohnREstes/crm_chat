<!-- //views/clients.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clients</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/navbar') %>
    <h1>Clients</h1>

    <!-- Form to add a new client -->
    <form action="/client/add" method="POST">
        <h2>Add New Client</h2>
        <input type="text" name="name" placeholder="Name" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="text" name="phone" placeholder="Phone" required>
        <textarea name="notes" placeholder="Notes"></textarea>
        <input type="text" name="address" placeholder="Address"> <!-- New field -->
        <input type="text" name="creditCardNumber" placeholder="Credit Card Number"> <!-- New field -->
        <input type="text" name="creditCardExpiry" placeholder="Expiry Date (MM/YY)"> <!-- New field -->
        <input type="text" name="creditCardCVV" placeholder="CVV"> <!-- New field -->
        <button type="submit">Add Client</button>
    </form>
    
    <!-- List of existing clients -->
    <ul>
        <% clients.forEach(client => { %>
        <li>
            <form action="/client/edit/<%= client._id %>" method="POST">
                <input type="text" name="name" value="<%= client.name %>" required>
                <input type="email" name="email" value="<%= client.email %>" required>
                <input type="text" name="phone" value="<%= client.phone %>" required>
                <textarea name="notes"><%= client.notes %></textarea>
                <input type="text" name="address" value="<%= client.address %>"> <!-- New field -->

                <!-- Display the last 4 digits always -->
                <input type="text" name="creditCardNumber" 
                    value="<%= client.decryptCreditCardNumber() ? client.decryptCreditCardNumber().slice(-4) : '' %>" readonly> <!-- Last 4 digits -->
                
                <!-- Full Credit Card Number with Show/Hide Toggle -->
                <input type="password" id="full_cc_<%= client._id %>" 
                    value="<%= client.decryptCreditCardNumber() ? client.decryptCreditCardNumber() : '' %>" 
                    style="display:none;" readonly>
                <button type="button" onclick="toggleCreditCard('full_cc_<%= client._id %>')">Show/Hide</button>

                <input type="text" name="creditCardExpiry" value="<%= client.creditCardExpiry %>"> <!-- New field -->
                <input type="text" name="creditCardCVV" value="<%= client.creditCardCVV %>"> <!-- New field -->
                
                <button type="submit">Save</button>
            </form>
        </li>
        <% }); %>
    </ul>

    <script>
        function toggleCreditCard(id) {
            const input = document.getElementById(id);
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }
    </script>
</body>
</html>
